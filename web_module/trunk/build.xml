<project name="topcoder" default="main" basedir=".">

   <property name="Name"          value="TopCoder" />
   <property name="version"       value="0.0.1" />
   <property name="build"         value="build" />
   <property name="war.dir"       value="${build}/wars" />
   <property name="war.name"      value="email.war"/>
   <property name="ejb_jars"      value="${build}/ejb_jars" />
   <property name="classes"       value="${build}/classes" />
   <property name="testclasses"   value="${build}/testcases" />
   <property name="build.javadocs" value="${build}/javadocs" />
   <property name="lib.dir"       value="lib" />
   <property name="jars.dir"      value="${lib.dir}/jars" />
   <property name="bin"           value="lib/bin" />
   <property name="src.dir"       value="src"/>
   <property name="java"          value="${src.dir}/main" />
   <property name="testjava"      value="${src.dir}/testcases" />
   <property name="resources"     value="resources" />
   <property name="images"        value="images" />
   <property name="mpsqas.jar"    value="${bin}/MPSQASApplet.jar"/>
   <property name="Jive.jar"      value="${bin}/Jive.jar"/>
   <property name="wl_jvmargs"    value="-Dweblogic.home=${WL_HOME}"  />
   <property name="servlets"      value="${build}/servlets" />
   <property name="web"           value="src/main/com/topcoder/web" />
   <property name="public_html"   value="/home/weblog5/weblogic1/tc_cluster/public_html" />
   <property environment="env"/>

   <property name="deprecation"   value="false" />
   <property name="debug"   value="true" />



   <path id="class.path">
      <pathelement location="${classes}" />
      <pathelement location="${testclasses}" />
      <pathelement location="${resources}" />
      <pathelement location="${images}" />
      <fileset dir="${jars.dir}">
         <include name="**/*.jar" />
      </fileset>
      <pathelement path="${env.CLASSPATH}"/>
   </path>

   <target name="init">
      <property name="statservlets"  value="com/topcoder/web/stat/servlet" />
      <property name="webservlets"   value="com/topcoder/web/servlet" />
      <property name="pactsservlets" value="com/topcoder/web/pacts/servlet" />
      <mkdir dir="${classes}" />
      <mkdir dir="${testclasses}" />
      <mkdir dir="${bin}" />
      <mkdir dir="${ejb_jars}" />
      <mkdir dir="${war.dir}" />
      <mkdir dir="${servlets}/${statservlets}" />
      <mkdir dir="${servlets}/${webservlets}" />
      <mkdir dir="${servlets}/${pactsservlets}" />
   </target>

    <target name="check_java_version">
        <available property="jdk1.4+" classname="java.nio.ByteBuffer" />
    </target>

   <target name="compile" depends="init,check_java_version">
      <javac
            srcdir="${java}"
            destdir="${classes}"
            classpathref="class.path"
            deprecation="${deprecation}"
            debug="${debug}"
            >
            <exclude
                name="com/topcoder/server/listener/nio/channels/spi/java14/*"
                unless="jdk1.4+"
            />
      </javac>

   </target>
   <target name="deploy" depends="servlets,jsp,moveStruts">
   </target>

   <target name="servlets" depends="compile">
      <move todir="${servlets}/${statservlets}">
         <fileset dir="${classes}/${statservlets}" >
                 <include name="**/*.class" />
         </fileset>
      </move>
      <move todir="${servlets}/${webservlets}">
         <fileset dir="${classes}/${webservlets}" >
                 <include name="**/*.class" />
         </fileset>
      </move>
      <move todir="${servlets}/${pactsservlets}">
         <fileset dir="${classes}/${pactsservlets}" >
                 <include name="**/*.class" />
         </fileset>
      </move>
   </target>

   <target name="moveStruts" depends="check_java_version">
      <copy todir="${public_html}/WEB-INF">
         <fileset dir="resources/stat" >
                 <include name="**/*.tld" />
         </fileset>
      </copy>
   </target>

   <target name="jsp" depends="check_java_version">
      <property name="stat.trgt"     value="${public_html}/stat_jsp" />
      <property name="stat.src"      value="${web}/stat/servlet/jsp" />
      <property name="root.trgt"     value="${public_html}" />
      <property name="root.src"      value="${web}/jsp" />
      <property name="pacts.trgt"    value="${public_html}/pacts" />
      <property name="pacts.src"     value="${web}/pacts/servlet/jsp" />
      <property name="project.trgt"  value="${public_html}/project" />
      <property name="project.src"   value="${web}/project/servlet/jsp" />
      <property name="reg.trgt"      value="${public_html}/reg" />
      <property name="reg.src"       value="${web}/reg/servlet/jsp" />
      <property name="render.trgt"   value="${public_html}/cm" />
      <property name="render.src"    value="${web}/render/servlet/jsp" />

      <mkdir dir="${stat.trgt}" />
      <mkdir dir="${root.trgt}" />
      <mkdir dir="${pacts.trgt}" />
      <mkdir dir="${project.trgt}" />
      <mkdir dir="${reg.trgt}" />
      <mkdir dir="${render.trgt}" />

      <copy todir="${stat.trgt}">
         <fileset dir="${stat.src}" >
                 <include name="**/*.jsp" />
         </fileset>
      </copy>
      <copy todir="${root.trgt}">
         <fileset dir="${root.src}" >
                 <include name="**/*.jsp" />
         </fileset>
      </copy>
      <copy todir="${pacts.trgt}">
         <fileset dir="${pacts.src}" >
                 <include name="**/*.jsp" />
         </fileset>
      </copy>
      <copy todir="${project.trgt}">
         <fileset dir="${project.src}" >
                 <include name="**/*.jsp" />
         </fileset>
      </copy>
      <copy todir="${reg.trgt}">
         <fileset dir="${reg.src}" >
                 <include name="**/*.jsp" />
         </fileset>
      </copy>
      <copy todir="${render.trgt}">
         <fileset dir="${render.src}" >
                 <include name="**/*.jsp" />
         </fileset>
      </copy>
   </target>


   <target name="run" depends="package">
   </target>

   <target name="package" depends="jars">
   </target>

   <target name="jars" depends="package-mpsqasApplat,package-Jive">
   </target>


   <target name="javadocs">
        <mkdir dir="${build.javadocs}"/>
        <javadoc
            packagenames="com.*"
            sourcepath="${java}"
            destdir="${build.javadocs}"
            windowtitle="${Name} API"
            doctitle="${Name} API"
            >
        </javadoc>
    </target>

   <target name="clean">
      <!-- kill the entire build dir -->
      <delete dir="${build}" />
      <delete dir="${bin}" />
   </target>

      <target name="main">
        <antcall target="run"/>
    </target>

	<target name="package-mpsqasApplat" depends="compile">
       <jar jarfile="${mpsqas.jar}" >
	       <fileset dir="${classes}/"
                includes="com/topcoder/mpsqas/**,com/topcoder/common/**"
				excludes="com/topcoder/common/web/**"
           />
       </jar>
   </target>

   <target name="package-Jive" depends="compile">
       <jar jarfile="${Jive.jar}" >
	       <fileset dir="${classes}/"
                includes="com/coolservlets/**"
           />
       </jar>
   </target>



   <target name="build.ejbs" depends="compile">
        <antcall target="package-EJB-PactsServicesBean"/>
        <antcall target="package-EJB-UserServicesBean"/>
        <antcall target="package-EJB-DataCacheBean"/>
        <antcall target="package-EJB-UtilBean"/>
        <antcall target="package-EJB-AuthenticationServicesBean"/>
        <antcall target="package-EJB-CoderStatisticsBean"/>
        <antcall target="package-EJB-StatisticsBean"/>
        <antcall target="package-EJB-EmailServicesBean"/>
        <antcall target="package-EJB-ContestAdminServicesBean"/>
        <antcall target="package-EJB-SearchBean"/>
        <antcall target="package-EJB-ReportingBean"/>
        <antcall target="package-EJB-ProjectServicesBean"/>
   </target>

<target name="package-EJB-ReportingBean" depends="compile,init-ReportingBean-properties,package-EJB-GenericBean"/>

<target name="init-ReportingBean-properties" >
       <property name="bean.dir"          value="Reporting" />
        <property name="bean.jar.name"     value="Reporting.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>

<target name="package-EJB-ProjectServicesBean" depends="compile,init-ProjectServicesBean-properties,package-EJB-GenericBean"/>

<target name="init-ProjectServicesBean-properties" >
       <property name="bean.dir"          value="ProjectServices" />
        <property name="bean.jar.name"     value="ProjectServices.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/web/project/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>

<target name="package-EJB-SearchBean" depends="compile,init-SearchBean-properties,package-EJB-GenericBean"/>

<target name="init-SearchBean-properties" >
       <property name="bean.dir"          value="Search" />
        <property name="bean.jar.name"     value="Search.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>

<target name="package-EJB-PactsServicesBean" depends="compile,init-PactsServicesBean-properties,package-EJB-GenericBean"/>

<target name="init-PactsServicesBean-properties" >
       <property name="bean.dir"          value="PactsServices" />
        <property name="bean.jar.name"     value="PactsServicesBean.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/web/pacts/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>

<target name="package-EJB-CoderStatisticsBean" depends="compile,init-CoderStatisticsBean-properties,package-EJB-GenericBean"/>

<target name="init-CoderStatisticsBean-properties" >
       <property name="bean.dir"          value="CoderStatistics" />
        <property name="bean.jar.name"     value="CoderStatistics.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>

<target name="package-EJB-AuthenticationServicesBean" depends="compile,init-AuthenticationServicesBean-properties,package-EJB-GenericBean"/>

<target name="init-AuthenticationServicesBean-properties" >
       <property name="bean.dir"          value="AuthenticationServices" />
        <property name="bean.jar.name"     value="AuthenticationServices.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>


<target name="package-EJB-ContestAdminServicesBean" depends="compile,init-ContestAdminServicesBean-properties,package-EJB-GenericBean"/>

<target name="init-ContestAdminServicesBean-properties" >
       <property name="bean.dir"          value="ContestAdminServices" />
        <property name="bean.jar.name"     value="ContestAdminServices.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>


    <target name="package-EJB-EmailServicesBean" depends="compile,init-EmailServicesBean-properties,package-EJB-GenericBean"/>

    <target name="init-EmailServicesBean-properties" >
        <property name="bean.dir"          value="EmailServices" />
        <property name="bean.jar.name"     value="EmailServices.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/server/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>


   <target name="package-EJB-StatisticsBean" depends="compile,init-StatisticsBean-properties,package-EJB-GenericBean"/>

   <target name="init-StatisticsBean-properties" >
       <property name="bean.dir"          value="Statistics" />
        <property name="bean.jar.name"     value="Statistics.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/web/stat/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>



   <target name="package-EJB-DataCacheBean" depends="compile,init-DataCacheBean-properties,package-EJB-GenericBean"/>

   <target name="init-DataCacheBean-properties" >
       <property name="bean.dir"          value="DataCache" />
        <property name="bean.jar.name"     value="DataCache.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>



   <target name="package-EJB-UtilBean" depends="compile,init-UtilBean-properties,package-EJB-GenericBean"/>

   <target name="init-UtilBean-properties" >
       <property name="bean.dir"          value="Util" />
        <property name="bean.jar.name"     value="Util.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>




   <target name="package-EJB-UserServicesBean" depends="compile,init-UserServicesBean-properties,package-EJB-GenericBean"/>

   <target name="init-UserServicesBean-properties" >
       <property name="bean.dir"          value="UserServices" />
        <property name="bean.jar.name"     value="UserServices.jar" />
        <property name="bean.pkg.dir"      value="com/topcoder/ejb/${bean.dir}" />
        <property name="bean.src.dir"      value="${java}/${bean.pkg.dir}" />
        <property name="bean.build.dir"    value="${classes}/${bean.pkg.dir}/build" />
        <property name="bean.meta-inf.dir" value="${bean.build.dir}/META-INF" />
   </target>



   <target name="initGenericBean" >
      <delete dir="${bean.build.dir}"/>
      <delete dir="${bean.class.dir}/*.class" />
      <mkdir  dir="${bean.build.dir}"/>
      <mkdir  dir="${bean.meta-inf.dir}"/>
   </target>





   <target name="package-EJB-GenericBean" depends="initGenericBean">

      <echo message="bean.src.dir ${bean.src.dir} "/>
      <echo message="bean.build.dir ${bean.build.dir} "/>
      <echo message="bean.meta-inf.dir ${bean.meta-inf.dir} "/>
      <echo message="Ant build of ${bean.jar.name} ."/>
      <copy todir="${bean.meta-inf.dir}">
         <fileset dir="${bean.src.dir}" >
                 <include name="*.xml" />
         </fileset>
      </copy>

      <javac
             srcdir="${bean.src.dir}"
             destdir="${bean.build.dir}"
             classpathref="class.path"
             deprecation="${deprecation}"
             debug="${debug}"
            >
      </javac>

      <jar jarfile="${bean.build.dir}/${bean.jar.name}"
             basedir="${bean.build.dir}"
             compress="true"
             excludes="*.jar"
      />

      <java classname="weblogic.ejbc" fork="yes" classpathref="class.path">
          <sysproperty value="-compiler" key="javac" />
          <sysproperty value="-classpath" key="${class.path}" />
          <arg line="${bean.build.dir}/${bean.jar.name} ${ejb_jars}/${bean.jar.name}" />
      </java>
      <echo message="Ant build of ${bean.jar.name} EJB completed successfully."/>

   </target>

    <target name="war.email" depends="compile">
        <delete dir="${war.dir}"/>
        <mkdir  dir="${war.dir}"/>
        <war warfile="${war.dir}/${war.name}" webxml="${resources}/email/web.xml">
            <fileset dir="${java}/com/topcoder/web/email/servlet/jsp">
                <include name="**/*.jsp"/>
            </fileset>
            <classes dir="${classes}">
                <include name="com/topcoder/web/email/**"/>
            </classes>
            <webinf dir="${resources}/email">
                <include name="email-taglib.tld"/>
            </webinf>
            <zipfileset dir="${java}/com/topcoder/web/email/servlet/jsp">
                <include name="**/*.jpg"/>
            </zipfileset>
        </war>
    </target>


</project>

