<project name="topcoder" basedir=".">

    <property name="jboss_home" value="../jboss-4.0.2"/>
    <property name="tempDeployDir" value="deploy"/>
    <property name="build" value="build"/>
    <property name="war_dir" value="${build}/wars"/>
	<property name="techassess_war_dir" value="${jboss_home}/server/default/deploy/techassess.war/"/>

    <target name="deploy-techassess" depends="">
        <!-- create backup -->
        <tstamp/>
        <property name="backupDirectory" value="backup/techassess/${DSTAMP}-${TSTAMP}"/>
        <echo message="Backing up to: ${backupDirectory}"/>
        <mkdir dir="${backupDirectory}"/>

        <copy todir="${backupDirectory}" file="build/wars/techassess.war"/>
        <copy todir="${backupDirectory}" file="lib/bin/shared.jar"/>
        <copy todir="${backupDirectory}" file="${jboss_home}/server/default/deploy/reconnect.jar"/>
        <copy todir="${backupDirectory}" file="${jboss_home}/server/default/deploy/ProblemServices.jar"/>
        <copy todir="${backupDirectory}" file="${jboss_home}/server/default/deploy/ScreeningServices.jar"/>
        <copy todir="${backupDirectory}" file="${jboss_home}/server/default/deploy/ScreeningTesterCompilerServices.jar"/>
        <copy todir="${backupDirectory}" file="${jboss_home}/server/default/deploy/ScreeningAdminServices.jar"/>
        <copy todir="${backupDirectory}" file="${jboss_home}/server/default/lib/Screening.jar"/>

        <mkdir dir="${tempDeployDir}"/>
        <unjar src="techassess.jar" dest="${tempDeployDir}"/>
        <copy overwrite="true" todir="${war_dir}" file="${tempDeployDir}/techassess.war"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/lib" file="${tempDeployDir}/shared.jar"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/deploy" file="${tempDeployDir}/reconnect.jar"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/deploy" file="${tempDeployDir}/ProblemServices.jar"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/deploy" file="${tempDeployDir}/ScreeningServices.jar"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/deploy" file="${tempDeployDir}/ScreeningTesterCompilerServices.jar"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/deploy" file="${tempDeployDir}/ScreeningAdminServices.jar"/>
        <copy overwrite="true" todir="${jboss_home}/server/default/lib" file="${tempDeployDir}/Screening.jar"/>
        <delete dir="${tempDeployDir}"/>
    	
    	<delete file="${jboss_home}/server/default/deploy/techassess.war"/>
    	<delete dir="${techassess_war_dir}"/>
    	<mkdir dir="${techassess_war_dir}"/>
        <unwar src="${war_dir}/techassess.war" dest="${techassess_war_dir}" overwrite="yes"/>
        <delete dir="${techassess_war_dir}/META-INF"/>
    </target>

</project>
