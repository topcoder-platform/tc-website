<!--
    This build script provides targets to assist in the
    moving of code to a production environment
 -->
<project name="topcoder" default="" basedir=".">

    <target name="package-topcoder" depends="">
<!--
        <delete dir="src"/>
        <delete dir="resources"/>
-->
        <delete dir="build"/>
<!--
        <delete dir="../shared/src"/>
-->
        <delete file="topcoder.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>
        <cvs command="update -Pd" package="build.xml"/>

        <exec dir="../shared" executable="cvs">
            <arg line="update -dP src"/>
        </exec>

        <ant antfile="build.xml" target="deploy"/>

        <jar destfile="./lib/bin/classes.jar" update="true">
            <fileset dir="./build/classes">
                <include name="**"/>
            </fileset>
        </jar>

        <jar destfile="topcoder.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/**"/>
                <include name="build/wars/**"/>
                <include name="resources/xsl/**"/>
                <include name="resources/taglib/**"/>
                <include name="resources/tc/**"/>
                <include name="resources/state/**"/>
                <include name="resources/corp/**"/>
                <include name="resources/email/**"/>
                <include name="resources/privatelabel/**"/>
                <include name="resources/TC.properties"/>
                <include name="resources/PrivateLabel.properties"/>
                <include name="move.xml"/>
                <include name="lib/bin/Jive.jar"/>
                <include name="lib/bin/shared.jar"/>
                <include name="lib/bin/classes.jar"/>
            </fileset>
        </jar>

    </target>

    <target name="package-techassess" depends="">
        <delete dir="src"/>
        <delete dir="resources"/>
        <delete dir="build"/>
        <delete dir="../shared/src"/>
        <delete file="techassess.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>

        <exec dir="../shared" executable="cvs">
            <arg line="update -dP src"/>
        </exec>

        <ant antfile="build.xml" target="war-techassess"/>
        <ant dir="../app" antfile="build.xml" target="screening-ejb-jars"/>

        <copy todir="." file="build/wars/techassess.war"/>
        <copy todir="." file="lib/bin/shared.jar"/>
        <copy todir="." file="../jboss-4.0.1/server/default/deploy/reconnect.jar"/>
        <copy todir="." file="../jboss-4.0.1/server/default/deploy/ProblemServices.jar"/>
        <copy todir="." file="../jboss-4.0.1/server/default/deploy/ScreeningServices.jar"/>
        <copy todir="." file="../jboss-4.0.1/server/default/deploy/ScreeningTesterCompilerServices.jar"/>
        <copy todir="." file="../jboss-4.0.1/server/default/deploy/ScreeningAdminServices.jar"/>
        <copy todir="." file="../jboss-4.0.1/server/default/lib/Screening.jar"/>

        <jar destfile="techassess.jar" update="true">
            <fileset dir=".">
                <include name="techassess.war"/>
                <include name="shared.jar"/>
                <include name="reconnect.jar"/>
                <include name="Screening.jar"/>
                <include name="ProblemServices.jar"/>
                <include name="ScreeningServices.jar"/>
                <include name="ScreeningTesterCompilerServices.jar"/>
                <include name="ScreeningAdminServices.jar"/>
            </fileset>
        </jar>
    </target>

    <target name="package-software" depends="">
        <cvs command="update -Pd"/>
        <exec dir="../shared" executable="cvs">
            <arg line="update -dP src"/>
        </exec>

        <ant antfile="build_or.xml" target="clean"/>
        <ant antfile="build_or.xml" target="dist"/>
        <ant antfile="build_dde.xml" target="dist"/>

    </target>

    <target name="package-forums" depends="">
<!--
        <delete dir="src"/>
-->
        <delete dir="build"/>
        <delete dir="../shared/src"/>
        <delete file="forums.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>
        <cvs command="update -Pd" package="build.xml"/>

        <exec dir="../shared" executable="cvs">
            <arg line="update -dP src"/>
        </exec>


        <ant antfile="build.xml" target="war-forums"/>
        <ant antfile="build.xml" target="package-EJB-MessageHistoryBean"/>

<!--
        <copy todir="../jboss-4.0.2/server/default/lib">
            <fileset dir="lib/bin">
                <include name="shared.jar"/>
            </fileset>
        </copy>
-->

        <jar destfile="forums.jar" update="true">
            <fileset dir=".">
                <include name="build/wars/forums.war"/>
                <include name="build/ejb_jars/messagehistory.jar"/>
                <include name="lib/bin/shared.jar"/>
            </fileset>
        </jar>


    </target>


</project>

