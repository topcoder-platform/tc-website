<!--
    This build script provides targets to assist in the
    moving of code to a production environment
 -->
<project name="topcoder" basedir=".">

    <property name="jboss_home" value="../jboss-4.0.2"/>
    <property name="tempMoveDir" value="move"/>
    <property name="tempDeployDir" value="deploy"/>
    <property name="build" value="build"/>
    <property name="war_dir" value="${build}/wars"/>
    <property name="techassess_war_dir" value="${jboss_home}/server/default/deploy/techassess.war/"/>

    <target name="jar-classes" >
        <jar destfile="./lib/bin/classes.jar" update="true">
            <fileset dir="./build/classes">
                <include name="**"/>
            </fileset>
        </jar>
    </target>

    <target name="package-topcoder" >

        <!--
                <delete dir="src"/>
                <delete dir="resources"/>
                <delete dir="../shared/src"/
        -->
        <delete dir="build"/>
        <delete file="topcoder.jar"/>

        <exec dir="." executable="svn">
            <arg line="update src resources lib build_tc.xml"/>
        </exec>

        <exec dir="../shared" executable="svn">
            <arg line="update"/>
        </exec>

        <exec dir="../external-artifacts" executable="svn">
            <arg line="update"/>
        </exec>


        <ant antfile="build_tc.xml" target="deploy"/>


        <antcall target="jar-classes"/>

        <jar destfile="topcoder.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/**"/>
                <include name="build/wars/**"/>
                <include name="build/sars/**"/>
                <include name="build/ears/security.ear"/>
                <include name="resources/xsl/**"/>
                <include name="resources/taglib/**"/>
                <include name="resources/tc/**"/>
<!--
                <include name="resources/longcontest/**"/>
-->
                <include name="resources/stat/**"/>
                <include name="resources/corp/**"/>
                <include name="resources/email/**"/>
                <include name="resources/privatelabel/**"/>
                <include name="resources/TC.properties"/>
                <include name="resources/PrivateLabel*.properties"/>
                <include name="resources/PactsInternalServlet.properties"/>
                <include name="resources/Registration.properties"/>
<!--
                <include name="resources/LongContest.properties"/>
-->
                <include name="resources/CorpConstants.properties"/>
                <include name="resources/DataAccess.properties"/>
                <include name="resources/EP.properties"/>
                <include name="resources/problem.xsd"/>
                <include name="move.xml"/>
                <include name="build_tc.xml"/>
                <include name="lib/bin/shared.jar"/>
                <include name="lib/bin/tcwebcommon.jar"/>
                <include name="lib/bin/classes.jar"/>

            </fileset>
        </jar>

    </target>


    <target name="package-software" >
        <cvs command="update -Pd"/>
        <exec dir="../shared" executable="cvs">
            <arg line="update -dP"/>
        </exec>
        <exec dir="../external-artifacts" executable="cvs">
            <arg line="update -dP"/>
        </exec>

        <ant antfile="build.xml" target="clean"/>
        <ant antfile="build_tcs.xml" target="build-site"/>
        <!--remove with new OR
                <ant antfile="build_tcs.xml" target="build-screening"/>
        -->

        <jar destfile="software.jar" update="true">
            <fileset dir=".">
                <include name="lib/bin/shared.jar"/>
                <include name="lib/bin/tcwebcommon.jar"/>
                <!--remove with new OR
                                <include name="lib/bin/screening.jar"/>
                -->
                <include name="build/ears/dde.ear"/>
                <!--remove with new OR
                                <include name="build/wars/review.war"/>
                -->
                <include name="build/wars/dde.war"/>
                <include name="build/wars/onsite.war"/>
                <include name="build/ejb_jars/Project.jar"/>
                <include name="build/ejb_jars/RBoard.jar"/>
                <!--remove with new OR
                                <include name="build/ejb_jars/Specification.jar"/>
                -->
                <include name="build_tcs.xml"/>
                <include name="resources/automatic_screening/com/topcoder/apps/**"/>
                <include name="resources/automatic_screening/com/topcoder/file/**"/>
                <include name="resources/automatic_screening/com/topcoder/util/**"/>
                <include name="resources/onsite.properties"/>
            </fileset>
        </jar>
    </target>

    <target name="package-forums" >
        <delete dir="build"/>
        <delete file="forums.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>
        <cvs command="update -Pd" package="build_forums.xml"/>
        <cvs command="update -Pd" package="build_common.xml"/>

        <exec dir="../shared" executable="cvs">
            <arg line="update -dP"/>
        </exec>

        <exec dir="../external-artifacts" executable="cvs">
            <arg line="update -dP"/>
        </exec>


        <ant antfile="build_forums.xml" target="build-forums"/>

        <jar destfile="forums.jar" update="true">
            <fileset dir=".">
                <include name="build/wars/forums.war"/>
                <include name="build/ejb_jars/messagehistory.jar"/>
                <include name="build/ejb_jars/User.jar"/>
                <include name="build/ears/security.ear"/>
                <include name="build/ejb_jars/Email.jar"/>
                <include name="build/ejb_jars/forums.jar"/>
                <include name="build/ejb_jars/security.jar"/>
                <include name="lib/bin/shared.jar"/>
                <include name="lib/bin/tcwebcommon.jar"/>
                <include name="lib/bin/tcjive.jar"/>
                <include name="build_forums.xml"/>
            </fileset>
        </jar>
    </target>

    <target name="package-studio" >

        <delete dir="build"/>
        <delete file="studio.jar"/>


        <exec dir="." executable="svn">
            <arg line="update src resources lib build_studio.xml"/>
        </exec>

        <exec dir="../shared" executable="svn">
            <arg line="update"/>
        </exec>

        <exec dir="../external-artifacts" executable="svn">
            <arg line="update"/>
        </exec>

        <ant antfile="build_studio.xml" target="deploy"/>
        <ant antfile="build_studio.xml" target="build-security"/>

        <jar destfile="studio.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/*.jar"/>
                <include name="build/wars/*.war"/>
                <include name="build/ears/*.ear"/>
                <include name="resources/studio/**"/>
                <include name="resources/forums/filter/**"/>
                <include name="resources/forums/studio/**"/>
                <include name="resources/Studio.properties"/>
                <include name="move.xml"/>
                <include name="build_studio.xml"/>
                <include name="lib/bin/*.jar"/>
            </fileset>
        </jar>

    </target>


    <target name="package-openaim" >

        <delete dir="build"/>
        <delete file="openaim.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>
        <cvs command="update -Pd" package="build_openaim.xml"/>
        <cvs command="update -Pd" package="build_tc.xml"/>

        <exec dir="../" executable="cvs">
            <arg line="checkout shared"/>
        </exec>

        <exec dir="../" executable="cvs">
            <arg line="checkout external-artifacts"/>
        </exec>


        <ant antfile="build_openaim.xml" target="deploy"/>
        <ant antfile="build_openaim.xml" target="build-security"/>

        <jar destfile="openaim.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/*.jar"/>
                <include name="build/wars/*.war"/>
                <include name="build/ears/*.ear"/>
                <include name="resources/openaim/**"/>
                <include name="resources/forums/filter/**"/>
                <include name="resources/forums/openaim/**"/>
                <include name="resources/OpenAIM.properties"/>
                <include name="move.xml"/>
                <include name="build_openaim.xml"/>
                <include name="lib/bin/*.jar"/>
            </fileset>
        </jar>

    </target>






    <target name="package-security" >

        <delete dir="build"/>
        <delete file="security.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>
        <cvs command="update -Pd" package="build_security.xml"/>

        <exec dir="../shared" executable="cvs">
            <arg line="update -dP"/>
        </exec>

        <exec dir="../external-artifacts" executable="cvs">
            <arg line="update -dP"/>
        </exec>


        <ant antfile="build_security.xml" target="deploy"/>

        <jar destfile="security.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/*.jar"/>
                <include name="build/ears/*.ear"/>
                <include name="move.xml"/>
                <include name="build_security.xml"/>
                <include name="lib/bin/*.jar"/>
            </fileset>
        </jar>

    </target>



    <target name="package-mm" >

        <delete dir="build"/>
        <delete file="mm.jar"/>

        <cvs command="update -Pd" package="src"/>
        <cvs command="update -Pd" package="resources"/>
        <cvs command="update -Pd" package="lib"/>
        <cvs command="update -Pd" package="build_mm.xml"/>

        <exec dir="../shared" executable="cvs">
            <arg line="update -dP"/>
        </exec>

        <exec dir="../external-artifacts" executable="cvs">
            <arg line="update -dP"/>
        </exec>

        <ant antfile="build_mm.xml" target="build"/>

        <jar destfile="mm.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/**"/>
                <include name="build/wars/**"/>
                <include name="build/ears/security.ear"/>
                <include name="resources/longcontest/**"/>
                <include name="resources/LongContest.properties"/>
                <include name="resources/DataAccess.properties"/>
                <include name="resources/problem.xsd"/>
                <include name="move.xml"/>
                <include name="build_mm.xml"/>
                <include name="lib/bin/shared.jar"/>
                <include name="lib/bin/tcwebcommon.jar"/>
            </fileset>
        </jar>

    </target>



    <target name="package-truveo" >

        <delete dir="build"/>
        <delete file="truveo.jar"/>

        <exec dir="." executable="svn">
            <arg line="update src resources lib build_truveo.xml"/>
        </exec>

        <exec dir="../shared" executable="svn">
            <arg line="update"/>
        </exec>

        <exec dir="../external-artifacts" executable="svn">
            <arg line="update"/>
        </exec>

        <ant antfile="build_truveo.xml" target="dist"/>
        <ant antfile="build_truveo.xml" target="build-security"/>

        <jar destfile="truveo.jar" update="true">
            <fileset dir=".">
                <include name="build/ejb_jars/*.jar"/>
                <include name="build/wars/*.war"/>
                <include name="build/ears/*.ear"/>
                <include name="resources/truveo/**"/>
                <include name="resources/forums/filter/**"/>
                <include name="resources/forums/truveo/**"/>
                <include name="resources/Truveo.properties"/>
                <include name="move.xml"/>
                <include name="build_truveo.xml"/>
                <include name="lib/bin/*.jar"/>
            </fileset>
        </jar>

    </target>









</project>

