<project name="topcoder" default="main" basedir=".">
    <property environment="env"/>
    <property name="Name" value="TopCoder"/>
    <property name="build" value="build"/>
    <property name="classes" value="${build}/classes"/>
    <property name="testclasses" value="${build}/testcases"/>
    <property name="global-dist.dir" value="${basedir}/../dist/artifacts"/>
    <property name="external.jars.dir" location="../external-artifacts"/>
    <property name="build.javadocs" value="${build}/javadocs"/>
    <property name="lib.dir" value="lib"/>
    <property name="jars.dir" value="${lib.dir}/jars"/>
    <property name="bin" value="lib/bin"/>
    <property name="src.dir" value="src"/>
    <property name="java" value="${src.dir}/main"/>
    <property name="shared.build" value="${basedir}/../shared"/>
    <property name="shared" value="../shared/src/main"/>
    <property name="testjava" value="${src.dir}/testcases"/>
    <property name="resources" value="resources"/>
    <property name="shared.jar" value="${bin}/shared.jar"/>
    <property name="common.jar" value="${bin}/tcwebcommon.jar"/>
    <property name="web" value="src/main/com/topcoder/web"/>

    <property name="deprecation" value="false"/>
    <property name="debug" value="true"/>
    <property name="junitsummary" value="on"/>

    <target name="main" depends="compile">
    </target>

    <path id="class.path">
        <pathelement location="${shared.jar}"/>
        <pathelement location="${external.jars.dir}/hibernate-3.2.5.jar"/>
        <pathelement location="${external.jars.dir}/hibernate-commons-annotations-3.3.0.jar"/>
        <pathelement location="${external.jars.dir}/hibernate-annotations-3.3.0.jar"/>
        <pathelement location="${external.jars.dir}/ejb3-persistence-3.3.0.jar"/>

        <pathelement location="${external.jars.dir}/servlet-api-2.4.jar"/>
        <pathelement location="${external.jars.dir}/jsp-api-2.0.jar"/>

        <pathelement location="${external.jars.dir}/jbossall-client-4.2.2.jar"/>
        <pathelement location="${external.jars.dir}/object_factory-2.0.1.jar"/>
        <pathelement location="${external.jars.dir}/jboss-cache-jdk50-4.2.2.jar"/>
        <pathelement location="${external.jars.dir}/file_upload-2.0.jar"/>
        <pathelement location="${external.jars.dir}/json_object-1.0.jar"/>
        <pathelement location="${external.jars.dir}/object_formatter-1.0.jar"/>
        <pathelement location="${external.jars.dir}/id_generator-3.0.0.jar"/>
        <pathelement location="${external.jars.dir}/jboss-system-4.2.2.jar"/>
        <pathelement location="${external.jars.dir}/base_exception-2.0.0.jar"/>
        <pathelement location="${external.jars.dir}/httpunit-1.6.2.jar"/>
        <pathelement location="${jars.dir}/tcs/contest_eligibility_validation_client/1.0.0/contest_eligibility_validation_client.jar"/>
    </path>
    <!-- adding this here because i can't figure out how to use the above path element in other path elements-->
    <property name="class.path" refid="class.path"/>

    <target name="init">
        <mkdir dir="${classes}"/>
        <mkdir dir="${testclasses}"/>
        <mkdir dir="${bin}"/>
    </target>

    <target name="compile_shared" depends="init" unless="compile_shared_set">
        <ant dir="${shared.build}" target="shared-all" inheritAll="false"/>
        <copy file="${global-dist.dir}/shared-SNAPSHOT.jar" tofile="${shared.jar}"/>
        <property name="compile_shared_set" value="true"/>
    </target>

    <target name="compile" depends="init,compile_shared" unless="compile_set">
        <depend srcdir="${java}" destdir="${classes}" cache="${build}/cache"/>
        <javac
                srcdir="${java}"
                destdir="${classes}"
                classpathref="class.path"
                deprecation="${deprecation}"
                debug="${debug}"
                source="1.5"
                target="1.5"
                fork="true">
            <include name="com/topcoder/common/**"/>
            <include name="com/topcoder/web/common/**"/>
        </javac>
        <property name="compile_set" value="true"/>
    </target>

    <target name="javadocs">
        <mkdir dir="${build.javadocs}"/>
        <javadoc
                packagenames="com.topcoder.common.*,com.topcoder.web.common.*"
                sourcepath="${java}"
                classpathref="class.path"
                destdir="${build.javadocs}"
                windowtitle="${Name} API"
                doctitle="${Name} API"
                maxmemory="256M"
                >
        </javadoc>
    </target>

    <target name="clean">
        <!-- kill the entire build dir -->
        <delete dir="${build}"/>
        <delete dir="${bin}"/>
        <ant dir="${shared.build}" target="clean"/>
    </target>

    <target name="build-dist" depends="compile">
        <jar jarfile="${common.jar}">
            <fileset dir="${classes}">
                <include name="com/topcoder/web/common/**/*.class"/>
                <include name="com/topcoder/common/**/*.class"/>
                <exclude name="com/topcoder/web/common/cache/admin/CacheAdmin.class"/>
            </fileset>
        </jar>
    </target>

</project>
